<div class="ticket-reservation-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Reserve Cinema Tickets</mat-card-title>
      <mat-card-subtitle
        >Select showtime and seats to reserve your tickets</mat-card-subtitle
      >
    </mat-card-header>

    <mat-card-content>
      <form
        [formGroup]="reservationForm"
        (ngSubmit)="onSubmit()"
        class="reservation-form"
      >
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Select Showtime</mat-label>
            <mat-select formControlName="showtimeId">
              <mat-option
                *ngFor="let showtime of showtimes"
                [value]="showtime.id"
              >
                {{ showtime.movieTitle }} -
                {{ showtime.startTime | date : "short" }} ({{ showtime.hall }})
                - ${{ showtime.price.toFixed(2) }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="reservationForm.get('showtimeId')?.hasError('required')"
            >
              Please select a showtime
            </mat-error>
          </mat-form-field>
        </div>

        <div *ngIf="selectedShowtime" class="showtime-info">
          <h3>Selected Showtime Details</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>Movie:</strong> {{ selectedShowtime.movieTitle }}
            </div>
            <div class="info-item">
              <strong>Time:</strong>
              {{ selectedShowtime.startTime | date : "short" }}
            </div>
            <div class="info-item">
              <strong>Hall:</strong> {{ selectedShowtime.hall }}
            </div>
            <div class="info-item">
              <strong>Price per seat:</strong> ${{
                selectedShowtime.price.toFixed(2)
              }}
            </div>
            <div class="info-item">
              <strong>Available seats:</strong>
              {{ selectedShowtime.availableSeats }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Customer Name</mat-label>
            <input
              matInput
              formControlName="customerName"
              placeholder="Enter customer name"
            />
            <mat-error
              *ngIf="reservationForm.get('customerName')?.hasError('required')"
            >
              Customer name is required
            </mat-error>
            <mat-error
              *ngIf="reservationForm.get('customerName')?.hasError('minlength')"
            >
              Customer name must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input
              matInput
              formControlName="customerEmail"
              type="email"
              placeholder="Enter email address"
            />
            <mat-error
              *ngIf="reservationForm.get('customerEmail')?.hasError('required')"
            >
              Email is required
            </mat-error>
            <mat-error
              *ngIf="reservationForm.get('customerEmail')?.hasError('email')"
            >
              Please enter a valid email address
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input
              matInput
              formControlName="phoneNumber"
              placeholder="Enter phone number"
            />
            <mat-error
              *ngIf="reservationForm.get('phoneNumber')?.hasError('required')"
            >
              Phone number is required
            </mat-error>
            <mat-error
              *ngIf="reservationForm.get('phoneNumber')?.hasError('pattern')"
            >
              Please enter a valid phone number
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Select Seats</mat-label>
            <mat-select
              formControlName="seatNumbers"
              multiple
              (selectionChange)="onSeatSelectionChange($event)"
            >
              <mat-option *ngFor="let seat of availableSeats" [value]="seat">
                Seat {{ seat }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="reservationForm.get('seatNumbers')?.hasError('required')"
            >
              Please select at least one seat
            </mat-error>
          </mat-form-field>
        </div>

        <div *ngIf="selectedSeats.length > 0" class="reservation-summary">
          <h3>Reservation Summary</h3>
          <div class="summary-content">
            <div class="selected-seats">
              <strong>Selected Seats:</strong> {{ selectedSeats.join(", ") }}
            </div>
            <div class="total-price">
              <strong>Total Price:</strong> ${{ totalPrice.toFixed(2) }}
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="onCancel()">Cancel</button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="reservationForm.invalid || selectedSeats.length === 0"
          >
            Reserve {{ selectedSeats.length }} Ticket{{
              selectedSeats.length !== 1 ? "s" : ""
            }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
